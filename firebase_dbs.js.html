<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: firebase/dbs.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: firebase/dbs.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import dayjs from "dayjs";
import customParseFormat from 'dayjs/plugin/customParseFormat'
import { deleteAttached } from "./storage";

/**
 * @module firebase_database
 */

/**
 * загружает объект задачи в базу данных firebase или редактирует уже существующую задачу
 * @param {FormData} form - объект формы задачи с полями title,descr,endDate,finished
 * @param {number} id - id задачи 
 * @returns {undefined | object} - объект ошибки или undefined, если ошибки нет
 */
export async function createTaskFromForm(form,id){
    dayjs.extend(customParseFormat)
    const formats = ["DD-MM-YYYY HH:mm","DD-MM-YYYY","DD.MM.YYYY HH:mm","DD.MM.YYYY"]
    const formattedDate = dayjs(form.get('endDate').trim(),formats).format("DD-MM-YYYY HH:mm")
    form.set('endDate',formattedDate)


  
    const body = JSON.stringify({
        id: id,
        title: form.get('title'),
        descr:form.get('descr'),
        endDate: form.get('endDate'),
        finished: form.get('finished') || false
    })


    let error;


    try{
        const resp = await fetch(`https://react-72706-default-rtdb.europe-west1.firebasedatabase.app/Todo/${id}.json`,{
            method:'PUT',
            body: body ,
            headers:{
                'Content-type':'application/json'
            }
           
        })
        if(resp.status !== 200){
            throw new Error(resp.statusText)
        }
    }catch(err){
        error =  err
    }



    if(error) return error


}


/**
 * Загружает все задачи из базы данных firebase
 * @returns {object} - объект со всеми задачами или объект ошибки
 */

export async function fetchTasks(){
    let error;
    let data;
    
    try{
        const resp = await fetch(`https://react-72706-default-rtdb.europe-west1.firebasedatabase.app/Todo.json`)
        if(resp.status !== 200){
            throw new Error(resp.statusText)
        }

         data = await resp.json()

    }catch(err){
        error =  err
    }

    return data || error;
}
/**
 * Удаляет задачу из базы данных firebase
 * @param {object} item - объект задачи
 * @returns {undefined | object} - объект ошибки или undefined, если ошибки нет
 */
export async function deleteTask(item){

    try{
        const resp = await fetch(`https://react-72706-default-rtdb.europe-west1.firebasedatabase.app/Todo/${item.id}.json`,{
            method:"DELETE"
        })
        if(resp.status !== 200){
            throw new Error(resp.statusText)
        } 
        await  deleteAttached(item.id)


    }catch(err){
        return err
    }
  
}</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-CreateTask_component.html">CreateTask_component</a></li><li><a href="module-Input_component.html">Input_component</a></li><li><a href="module-Task_component.html">Task_component</a></li><li><a href="module-ViewTask_components.html">ViewTask_components</a></li><li><a href="module-firebase_database.html">firebase_database</a></li><li><a href="module-firebase_storage.html">firebase_storage</a></li><li><a href="module-logic_date.html">logic_date</a></li><li><a href="module-logic_validations.html">logic_validations</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.0</a> on Sun Nov 20 2022 19:30:06 GMT+0300 (Москва, стандартное время)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
